(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{353:function(t,e,n){"use strict";n.r(e);n(37),n(77);var o=n(116),c=n(52),r={name:"IndexPage",middleware:"auth",data:function(){return{calling:!1,phone:"263781061438",status:"Dialing",ua:null,rtc:null,connected:!1}},computed:Object(c.c)(["creds","hasMicAccess"]),methods:{call:function(){if(console.log(this.creds),!this.connected)return this.$refs.alert.open("No connection","error");if(!this.hasMicAccess)return this.$refs.alert.open("Microphone Access denied.","warn");if(this.calling)this.rtc&&this.ua&&(this.rtc.terminate(),this.rtc=null);else{if(!this.phone)return this.$refs.alert.open("Phone is required","error");this.calling=!0,this.ua.call("sip:".concat(this.phone,"@one.jambotalk.com"),{mediaConstraints:{audio:!0,video:!1}})}},connect:function(){var t=this;if(this.ua)this.ua.start();else{this.$refs.alert.open("Connecting","loading",!0),o.debug.disable("JsSIP:*");var e={sockets:[new o.WebSocketInterface("wss://one.jambotalk.com:8089/ws")],uri:"sip:".concat(this.creds.username,"@one.jambotalk.com"),password:this.creds.pwd},n=new o.UA(e);n.on("connected",(function(){t.connected=!0,t.$refs.alert.open("Connected","success")})),n.on("disconnected",(function(){t.connected=!1,t.$refs.alert.open("Disconnected","warn")})),n.on("newRTCSession",this.newRTCSession),this.ua=n,n.start()}},newRTCSession:function(data){var t=this,rtc=data.session;console.log("NEW SESSION - "+rtc.direction,rtc),rtc.on("failed",(function(){t.status="Failed",setTimeout((function(){t.calling=!1,t.status=""}),2e3)})),rtc.on("confirmed",(function(){t.status="Answered"})),rtc.on("ended",(function(e){t.status="Ended",setTimeout((function(){t.calling=!1,t.status=""}),500)})),this.rtc=rtc,rtc.connection.ontrack=function(e){console.log("'Remote ontrack: ".concat(e.track.kind," - ").concat(e.track.id," stream ").concat(e.streams[0].id));for(var i=0;i<e.streams.length;++i){var n=e.streams[i];console.log(t.$refs.audio),t.$refs.audio.srcObject=n}},rtc.connection.onremovestream=function(t){console.log("onremovestream: "+t.stream.id)}}}},l=n(23),component=Object(l.a)(r,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"card card-style"},[e("div",{staticClass:"content mb-3"},[e("h1",[t._v("Call Platform Testing "),t.connected?t._e():e("a",{attrs:{href:"javascript:;"},on:{click:t.connect}},[t._v("Connect")])]),t._v(" "),t.calling?e("p",[e("i",{staticClass:"fa fa-spin fa-sync"}),t._v(" "+t._s(t.status)+" "+t._s(t.phone)+"\n      ")]):e("div",{staticClass:"input-style no-borders no-icon validate-field mb-4"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.phone,expression:"phone"}],staticClass:"form-control validate-text",attrs:{type:"tel",placeholder:"Phone"},domProps:{value:t.phone},on:{input:function(e){e.target.composing||(t.phone=e.target.value)}}}),t._v(" "),e("label",{staticClass:"color-highlight",attrs:{for:"form4aa"}},[t._v("Phone")]),t._v(" "),e("i",{staticClass:"fa fa-times disabled invalid color-red-dark"}),t._v(" "),e("i",{staticClass:"fa fa-check disabled valid color-green-dark"})]),t._v(" "),e("a",{staticClass:"btn btn-full btn-m rounded-sm font-700 text-uppercase bg-highlight",attrs:{href:"javascript:;"},on:{click:t.call}},[t._v(t._s(t.calling?"Hangup":"Call"))])])]),t._v(" "),e("UtilsAlert",{ref:"alert"}),t._v(" "),e("audio",{ref:"audio",attrs:{autoplay:"autoplay"}})],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{UtilsAlert:n(221).default})}}]);