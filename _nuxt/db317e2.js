(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{793:function(t,e,r){"use strict";r.r(e);r(36),r(25),r(33),r(47),r(48);var n=r(3),o=r(14),c=r(56),l=r(31),f=(r(29),r(9),r(43),r(44),r(153),r(37),r(32),r(67),r(125),r(780),r(781),r(16));function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function m(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var h={name:"UserAuth",components:{VuePhoneNumberInput:function(){return r.e(18).then(r.t.bind(null,790,7))}},layout:"auth",data:function(){return{focus:null,country:null,enteredPhone:null,recaptcha:null,resend_counter:null,result:null,enterOTP:!1,verifier:null,otp:{},otpDigits:["a","b","c","d","e","f"],username:null}},head:function(){return{title:"📞 Jambo Talk - Login"}},computed:Object(f.d)(["darkTheme"]),watch:{otp:{handler:function(t){var e=this,r=[t.a,t.b,t.c,t.d,t.e,t.f];if(-1!==r.findIndex((function(t){return t&&1!=="".concat(t).length})))for(var i=0;i<r.length;i++){var n="".concat(r[i]);if(n.length>1&&6!==n.length)return this.defaultOtp(),setTimeout((function(){e.$refs.OTPinputs[0].focus()}),100);if(6===n.length){var o=function(){e.$refs.OTPinputs.forEach((function(t){t.blur()}));var t=n.split(""),r=Object(l.a)(t,6),a=r[0],b=r[1],o=r[2],c=r[3],f=r[4],d=r[5];return{v:setTimeout((function(){e.otp={a:a,b:b,c:o,d:c,e:f,f:d}}),50)}}();if("object"===Object(c.a)(o))return o.v}}},deep:!0}},mounted:function(){var t=document.querySelectorAll(".otp");t[0]&&t.forEach((function(t){t.addEventListener("focus",(function(e){t.value=""})),t.addEventListener("input",(function(e){t.nextElementSibling?t.nextElementSibling.focus():t.blur()}))})),this.defaultOtp()},methods:m(m({},Object(f.c)(["saveCreds"])),{},{setupVerify:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.verifier){e.next=2;break}return e.abrupt("return",Promise.resolve(t.verifier));case 2:return r=t.$fireModule.auth.RecaptchaVerifier,t.verifier=new r(t.$refs.recaptcha,{size:"invisible"}),e.next=6,t.verifier.verify();case 6:return t.recaptcha=t.verifier,e.abrupt("return",Promise.resolve(t.recaptcha));case 8:case"end":return e.stop()}}),e)})))()},register:function(){var t=this,e=this.enteredPhone||{},r=e.isValid,n=e.formattedNumber;return r?(this.$nuxt.$emit("alert",{msg:"Validating...",role:"loading",loading:!0}),this.setupVerify().then((function(e){return t.$fire.auth.signInWithPhoneNumber(n,e)})).then((function(e){t.result=e,t.defaultOtp(),t.$nuxt.$emit("alert",{}),t.enterOTP=!0,t.username=n})).catch((function(e){var r=e&&e.code?e.message:"Error, please reload page";return console.log({msg:r},e),t.$nuxt.$emit("alert",{msg:"Error, please reload page",role:"error",timeout:3e3})}))):this.$nuxt.$emit("alert",{msg:"Invalid phone",role:"warn",timeout:3e3})},resendCounter:function(){var t,e,r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:115,o=n,c=setInterval((function(){t=parseInt(o/60,10),e=parseInt(o%60,10),t=t<10?"0"+t:t,e=e<10?"0"+e:e,r.resend_counter="in ".concat(t,":").concat(e),--o<0&&(r.resend_counter=null,clearInterval(c))}),1e3)},defaultOtp:function(){var t={};this.otpDigits.forEach((function(e){t[e]="●"})),this.otp=t},resendOtp:function(){var t=this;this.resend_counter||(this.resendCounter(),this.$fire.auth.signInWithPhoneNumber(this.username,this.recaptcha).then((function(e){t.result=e,t.defaultOtp(),t.enterOTP=!0})).catch((function(t){console.error(t)})))},verifyOTP:function(){var t=this,code=Object.values(this.otp).join("");if(!this.result)return this.$nuxt.$emit("alert",{msg:"Error, reload page.",role:"error"});this.enterOTP=!1,this.$nuxt.$emit("alert",{msg:"Verifying...",role:"loading",loading:!0}),this.result.confirm(code).then(Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$fire.auth.currentUser.getIdToken();case 2:return r=e.sent,n=t.$fire.auth.currentUser,o=n.phoneNumber,c=n.uid,t.$axios.setToken(r,"Bearer"),e.prev=5,e.next=8,t.$axios.$get("v0.1/register/".concat(c));case 8:l=e.sent,t.saveCreds(m(m({},l),{},{username:o})),t.$nuxt.$emit("alert",{msg:"Registration successful",role:"success",timeout:3300}),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",t.$nuxt.$emit("alert",{msg:"Error. Refresh page",role:"error"}));case 16:return e.abrupt("return",setTimeout((function(){return t.$router.push("/")}),1e3));case 17:case"end":return e.stop()}}),e,null,[[5,13]])})))).catch((function(){t.enterOTP=!0}))}})},v=h,w=r(12),component=Object(w.a)(v,(function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"page-content pb-0"},[e("div",{staticClass:"card tw-h-screen",attrs:{"data-card-height":"cover"}},[e("div",{staticClass:"card-center tw-transition-all tw-duration-180",class:[t.focus?"":"-tw-mt-[200px]"]},[e("div",{staticClass:"tw-px-12"},[e("h3",{staticClass:"text-center mb-4"},[t._v("\n            Enter your phone number\n          ")]),t._v(" "),e("VuePhoneNumberInput",{staticClass:"tw-mb-3",attrs:{"default-country-code":"ZA","no-example":!0,dark:t.darkTheme,size:"md"},on:{"phone-number-focused":function(e){t.focus=!0},"phone-number-blur":function(e){t.focus=!1},update:function(e){t.enteredPhone=e}},model:{value:t.country,callback:function(e){t.country=e},expression:"country"}}),t._v(" "),e("p",{staticClass:"text-center font-12 mt-n2 mb-2"},[t._v("\n            Carrier charges may apply\n          ")]),t._v(" "),e("button",{staticClass:"tw-w-full shadow-large tw-border-0 tw-py-2 tw-bg-[#B00020] active:tw-bg-primary-700 tw-uppercase tw-text-gray-50 tw-rounded-lg tw-font-semibold tw-tracking-wider",on:{click:function(e){return t.register()}}},[t._v("\n            Register\n          ")])],1)])]),t._v(" "),e("div",{ref:"recaptcha",staticClass:"absolute"})]),t._v(" "),e("div",{staticClass:"menu menu-box-bottom tw-block tw-h-full tw-w-full",class:{"menu-active":t.enterOTP},attrs:{id:"menu-user","data-menu-width":"cover","data-menu-effect":"menu-over"}},[e("div",[e("a",{staticClass:"close-menu icon icon-m mt-n2 notch-clear position-absolute start-0 color-theme",on:{click:function(e){t.enterOTP=!t.enterOTP}}},[e("i",{staticClass:"fa fa-chevron-left"})]),t._v(" "),e("img",{staticClass:"mx-auto tw-mt-6",attrs:{src:"/assets/images/2.svg",width:"200",alt:"Passcode"}}),t._v(" "),e("h1",{staticClass:"text-center pt-4"},[t._v("\n        Enter One Time Passcode\n      ")]),t._v(" "),t._m(0),t._v(" "),e("div",{staticClass:"text-center mb-3 pt-3 pb-2"},[e("form",{attrs:{action:""}},t._l(t.otpDigits,(function(r){return e("input",{directives:[{name:"model",rawName:"v-model",value:t.otp[r],expression:"otp[o]"}],key:r,ref:"OTPinputs",refInFor:!0,staticClass:"otp mx-1 text-center font-24 font-900",attrs:{placeholder:t.otp[r],type:"number"},domProps:{value:t.otp[r]},on:{focus:function(e){t.otp[r]=""},blur:function(e){!t.otp[r]&&(t.otp[r]="●")},input:function(e){e.target.composing||t.$set(t.otp,r,e.target.value)}}})})),0)]),t._v(" "),e("div",{staticClass:"tw-px-12"},[e("button",{staticClass:"tw-w-full tw-border-0 tw-py-2 tw-bg-[#B00020] active:tw-bg-primary-700 tw-uppercase tw-text-gray-50 tw-rounded-lg tw-font-semibold tw-tracking-wider",on:{click:function(e){return t.verifyOTP()}}},[t._v("\n          Verify\n        ")])]),t._v(" "),e("p",{staticClass:"pt-2 font-11 text-center mb-0"},[t._v("\n        Didn't receive your code? "),e("a",{class:[t.resend_counter?"tw-text-gray-400":""],attrs:{href:"javascript:;"},on:{click:t.resendOtp}},[t._v("Resend OTP "+t._s(t.resend_counter||""))])])])]),t._v(" "),e("UtilsAlert")],1)}),[function(){var t=this,e=t._self._c;return e("p",{staticClass:"text-center font-12 mt-n2 mb-2"},[t._v("\n        To verify your "),e("b",[t._v("Jambo")]),t._v(" account.\n      ")])}],!1,null,null,null);e.default=component.exports;installComponents(component,{UtilsAlert:r(425).default})}}]);
//# sourceMappingURL=db317e2.js.map