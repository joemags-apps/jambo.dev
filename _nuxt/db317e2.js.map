{"version":3,"sources":["webpack:///./pages/auth.vue","webpack:///./pages/auth.vue?ab1f","webpack:///./pages/auth.vue?6b69"],"names":["name","components","VuePhoneNumberInput","layout","data","focus","country","enteredPhone","recaptcha","resend_counter","result","enterOTP","verifier","otp","otpDigits","username","head","title","computed","mapState","watch","handler","arr","a","b","c","d","e","f","findIndex","v","length","i","val","this","defaultOtp","setTimeout","$refs","OTPinputs","forEach","el","blur","split","deep","mounted","document","querySelectorAll","addEventListener","value","nextElementSibling","methods","mapMutations","setupVerify","Promise","resolve","RecaptchaVerifier","$fireModule","auth","size","verify","register","isValid","formattedNumber","$nuxt","$emit","msg","role","loading","then","$fire","signInWithPhoneNumber","catch","err","code","message","console","log","timeout","resendCounter","minutes","seconds","duration","timer","tm","setInterval","parseInt","clearInterval","o","resendOtp","res","error","verifyOTP","Object","values","join","confirm","currentUser","getIdToken","token","phone","phoneNumber","uid","$axios","setToken","$get","creds","saveCreds","$router","push","component","_vm","_c","_self","staticClass","attrs","class","_v","darkTheme","on","$event","model","callback","$$v","expression","ref","_m","_l","directives","rawName","key","refInFor","domProps","target","composing","$set","_s","installComponents","UtilsAlert","default"],"mappings":"+HAAA,I,yuBAKe,OACbA,KAAM,WACNC,WAAY,CACVC,oBAAqB,kBAAM,kCAAN,GAEvBC,OAAQ,OACRC,KANa,WAOX,MAAO,CACLC,MAAO,KACPC,QAAS,KACTC,aAAc,KACdC,UAAW,KACXC,eAAgB,KAChBC,OAAQ,KACRC,UAAU,EACVC,SAAU,KACVC,IAAK,CAAC,EACNC,UAAW,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,KACrCC,SAAU,KAEb,EACDC,KArBa,WAsBX,MAAO,CACLC,MAAO,wBAEV,EACDC,SAAUC,YAAS,CAAC,cACpBC,MAAO,CACLP,IAAK,CACHQ,QADG,YAC4B,WACvBC,EAAM,CADiB,EAApBC,EAAoB,EAAjBC,EAAiB,EAAdC,EAAc,EAAXC,EAAW,EAARC,EAAQ,EAALC,GAExB,IAAsD,IAAlDN,EAAIO,WAAU,SAAAC,GAAC,OAAIA,GAAuB,IAAlB,UAAGA,GAAIC,MAAhB,IAGnB,IAAK,IAAIC,EAAI,EAAGA,EAAIV,EAAIS,OAAQC,IAAK,CACnC,IAAMC,EAAM,GAAH,OAAMX,EAAIU,IACnB,GAAIC,EAAIF,OAAS,GAAoB,IAAfE,EAAIF,OAExB,OADAG,KAAKC,aACEC,YAAW,WAChB,EAAKC,MAAMC,UAAU,GAAGjC,OACzB,GAAE,KAEL,GAAmB,IAAf4B,EAAIF,OAAc,kBACpB,EAAKM,MAAMC,UAAUC,SAAQ,SAACC,GAC5BA,EAAGC,MACJ,IACD,MAA2BR,EAAIS,MAAM,IAArC,mBAAOnB,EAAP,KAAUC,EAAV,KAAaC,EAAb,KAAgBC,EAAhB,KAAmBC,EAAnB,KAAsBC,EAAtB,KACA,MAAO,CAAP,EAAOQ,YAAW,WAChB,EAAKvB,IAAM,CACTU,IAAGC,IAAGC,IAAGC,IAAGC,IAAGC,IAElB,GAAE,IATiB,2CAUrB,CACF,CACF,EACDe,MAAM,IAGVC,QA1Da,WA2DX,IAAM/B,EAAMgC,SAASC,iBAAiB,QAClCjC,EAAI,IACNA,EAAI0B,SAAQ,SAACC,GACXA,EAAGO,iBAAiB,SAAS,SAACpB,GAAQa,EAAGQ,MAAQ,EAAI,IACrDR,EAAGO,iBAAiB,SAAS,SAACpB,GAAQa,EAAGS,mBAAqBT,EAAGS,mBAAmB5C,QAAUmC,EAAGC,MAAQ,GAC1G,IAEHP,KAAKC,YACN,EACDe,QAAS,EAAF,KACFC,YAAa,CAAC,eADZ,IAECC,YAFC,WAEc,8JACf,EAAKxC,SADU,yCAEVyC,QAAQC,QAAQ,EAAK1C,WAFX,cAIX2C,EAAsB,EAAKC,YAAYC,KAAvCF,kBACR,EAAK3C,SAAW,IAAI2C,EAAkB,EAAKlB,MAAM7B,UAAW,CAAEkD,KAAM,cALjD,SAMb,EAAK9C,SAAS+C,SAND,cAOnB,EAAKnD,UAAY,EAAKI,SAPH,kBAQZyC,QAAQC,QAAQ,EAAK9C,YART,4CASpB,EACDoD,SAZO,WAYK,WACV,EAAqC1B,KAAK3B,cAAgB,CAAC,EAAnDsD,EAAR,EAAQA,QAASC,EAAjB,EAAiBA,gBACjB,OAAKD,GAGH3B,KAAK6B,MAAMC,MAAM,QAAS,CAAEC,IAAK,gBAAiBC,KAAM,UAAWC,SAAS,IAEvEjC,KAAKkB,cACTgB,MAAK,SAAC5D,GACL,OAAO,EAAK6D,MAAMZ,KAAKa,sBAAsBR,EAAiBtD,EAC/D,IACA4D,MAAK,SAAC1D,GACL,EAAKA,OAASA,EACd,EAAKyB,aACL,EAAK4B,MAAMC,MAAM,QAAS,CAAC,GAC3B,EAAKrD,UAAW,EAChB,EAAKI,SAAW+C,CACjB,IACAS,OAAM,SAACC,GACN,IAAMP,EAAOO,GAAOA,EAAIC,KAAQD,EAAIE,QAAU,4BAE9C,OADAC,QAAQC,IAAI,CAAEX,OAAOO,GACd,EAAKT,MAAMC,MAAM,QAAS,CAAEC,IAAK,4BAA6BC,KAAM,QAASW,QAAS,KAC9F,KAnBM3C,KAAK6B,MAAMC,MAAM,QAAS,CAAEC,IAAK,gBAAiBC,KAAM,OAAQW,QAAS,KAoBnF,EACDC,cApCO,WAoCwB,IAEzBC,EACAC,EAHyB,OAAhBC,EAAgB,uDAAL,IACpBC,EAAQD,EAGNE,EAAKC,aAAY,WACrBL,EAAUM,SAASH,EAAQ,GAAI,IAC/BF,EAAUK,SAASH,EAAQ,GAAI,IAE/BH,EAAUA,EAAU,GAAK,IAAMA,EAAUA,EACzCC,EAAUA,EAAU,GAAK,IAAMA,EAAUA,EACzC,EAAKvE,eAAL,aAA4BsE,EAA5B,YAAuCC,KACjCE,EAAQ,IACZ,EAAKzE,eAAiB,KACtB6E,cAAcH,GAEjB,GAAE,IACJ,EACDhD,WArDO,WAsDL,IAAMtB,EAAM,CAAC,EACbqB,KAAKpB,UAAUyB,SAAQ,SAACgD,GACtB1E,EAAI0E,GAAK,GACV,IACDrD,KAAKrB,IAAMA,CACZ,EACD2E,UA5DO,WA4DM,WACPtD,KAAKzB,iBAGTyB,KAAK4C,gBACL5C,KAAKmC,MAAMZ,KAAKa,sBAAsBpC,KAAKnB,SAAUmB,KAAK1B,WACvD4D,MAAK,SAACqB,GACL,EAAK/E,OAAS+E,EACd,EAAKtD,aACL,EAAKxB,UAAW,CACjB,IACA4D,OAAM,SAACC,GACNG,QAAQe,MAAMlB,EACf,IACJ,EACDmB,UA3EO,WA2EM,WACLlB,KAAOmB,OAAOC,OAAO3D,KAAKrB,KAAKiF,KAAK,IAC1C,IAAK5D,KAAKxB,OACR,OAAOwB,KAAK6B,MAAMC,MAAM,QAAS,CAAEC,IAAK,sBAAuBC,KAAM,UAEvEhC,KAAKvB,UAAW,EAChBuB,KAAK6B,MAAMC,MAAM,QAAS,CAAEC,IAAK,eAAgBC,KAAM,UAAWC,SAAS,IAC3EjC,KAAKxB,OACFqF,QAAQtB,MACRL,KAFH,qCAEQ,2HACgB,EAAKC,MAAMZ,KAAKuC,YAAYC,aAD5C,cACEC,EADF,SAEgC,EAAK7B,MAAMZ,KAAKuC,YAA/BG,EAFjB,EAEIC,YAAoBC,EAFxB,EAEwBA,IAC5B,EAAKC,OAAOC,SAASL,EAAO,UAHxB,kBAKkB,EAAKI,OAAOE,KAAZ,wBAAkCH,IALpD,OAKII,EALJ,OAMF,EAAKC,UAAL,OAAoBD,GAApB,IAA2B1F,SAAUoF,KACrC,EAAKpC,MAAMC,MAAM,QAAS,CAAEC,IAAK,0BAA2BC,KAAM,UAAWW,QAAS,OAPpF,2EASK,EAAKd,MAAMC,MAAM,QAAS,CAAEC,IAAK,sBAAuBC,KAAM,WATnE,iCAWG9B,YAAW,WAChB,OAAO,EAAKuE,QAAQC,KAAK,IAC1B,GAAE,MAbC,2DAeLrC,OAAM,WACL,EAAK5D,UAAW,CACjB,GACJ,KC/K6O,I,QCO9OkG,UAAY,YACd,GFRW,WAAkB,IAAIC,EAAI,KAAKC,EAAGD,EAAIE,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACA,EAAG,MAAM,CAACE,YAAY,qBAAqB,CAACF,EAAG,MAAM,CAACE,YAAY,mBAAmBC,MAAM,CAAC,mBAAmB,UAAU,CAACH,EAAG,MAAM,CAACE,YAAY,gDAAgDE,MAAM,CAAEL,EAAIzG,MAA2B,GAAnB,mBAAwB,CAAC0G,EAAG,MAAM,CAACE,YAAY,YAAY,CAACF,EAAG,KAAK,CAACE,YAAY,oBAAoB,CAACH,EAAIM,GAAG,uDAAuDN,EAAIM,GAAG,KAAKL,EAAG,sBAAsB,CAACE,YAAY,UAAUC,MAAM,CAAC,uBAAuB,KAAK,cAAa,EAAK,KAAOJ,EAAIO,UAAU,KAAO,MAAMC,GAAG,CAAC,uBAAuB,SAASC,GAAQT,EAAIzG,OAAQ,CAAK,EAAC,oBAAoB,SAASkH,GAAQT,EAAIzG,OAAQ,CAAM,EAAC,OAAS,SAASkH,GAAQT,EAAIvG,aAAegH,CAAO,GAAEC,MAAM,CAACxE,MAAO8D,EAAIxG,QAASmH,SAAS,SAAUC,GAAMZ,EAAIxG,QAAQoH,CAAI,EAACC,WAAW,aAAab,EAAIM,GAAG,KAAKL,EAAG,IAAI,CAACE,YAAY,kCAAkC,CAACH,EAAIM,GAAG,yDAAyDN,EAAIM,GAAG,KAAKL,EAAG,SAAS,CAACE,YAAY,oKAAoKK,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOT,EAAIlD,UAAW,IAAG,CAACkD,EAAIM,GAAG,yCAAyC,OAAON,EAAIM,GAAG,KAAKL,EAAG,MAAM,CAACa,IAAI,YAAYX,YAAY,eAAeH,EAAIM,GAAG,KAAKL,EAAG,MAAM,CAACE,YAAY,oDAAoDE,MAAM,CAAC,cAAgBL,EAAInG,UAAUuG,MAAM,CAAC,GAAK,YAAY,kBAAkB,QAAQ,mBAAmB,cAAc,CAACH,EAAG,MAAM,CAACA,EAAG,IAAI,CAACE,YAAY,iFAAiFK,GAAG,CAAC,MAAQ,SAASC,GAAQT,EAAInG,UAAYmG,EAAInG,QAAS,IAAG,CAACoG,EAAG,IAAI,CAACE,YAAY,yBAAyBH,EAAIM,GAAG,KAAKL,EAAG,MAAM,CAACE,YAAY,kBAAkBC,MAAM,CAAC,IAAM,uBAAuB,MAAQ,MAAM,IAAM,cAAcJ,EAAIM,GAAG,KAAKL,EAAG,KAAK,CAACE,YAAY,oBAAoB,CAACH,EAAIM,GAAG,+CAA+CN,EAAIM,GAAG,KAAKN,EAAIe,GAAG,GAAGf,EAAIM,GAAG,KAAKL,EAAG,MAAM,CAACE,YAAY,8BAA8B,CAACF,EAAG,OAAO,CAACG,MAAM,CAAC,OAAS,KAAKJ,EAAIgB,GAAIhB,EAAIhG,WAAW,SAASyE,GAAG,OAAOwB,EAAG,QAAQ,CAACgB,WAAW,CAAC,CAAC/H,KAAK,QAAQgI,QAAQ,UAAUhF,MAAO8D,EAAIjG,IAAI0E,GAAIoC,WAAW,WAAWM,IAAI1C,EAAEqC,IAAI,YAAYM,UAAS,EAAKjB,YAAY,wCAAwCC,MAAM,CAAC,YAAcJ,EAAIjG,IAAI0E,GAAG,KAAO,UAAU4C,SAAS,CAAC,MAASrB,EAAIjG,IAAI0E,IAAK+B,GAAG,CAAC,MAAQ,SAASC,GAAQT,EAAIjG,IAAI0E,GAAK,EAAG,EAAC,KAAO,SAASgC,IAAQT,EAAIjG,IAAI0E,KAAUuB,EAAIjG,IAAI0E,GAAK,IAAI,EAAC,MAAQ,SAASgC,GAAWA,EAAOa,OAAOC,WAAiBvB,EAAIwB,KAAKxB,EAAIjG,IAAK0E,EAAGgC,EAAOa,OAAOpF,MAAO,IAAI,IAAE,KAAK8D,EAAIM,GAAG,KAAKL,EAAG,MAAM,CAACE,YAAY,YAAY,CAACF,EAAG,SAAS,CAACE,YAAY,uJAAuJK,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOT,EAAInB,WAAY,IAAG,CAACmB,EAAIM,GAAG,oCAAoCN,EAAIM,GAAG,KAAKL,EAAG,IAAI,CAACE,YAAY,iCAAiC,CAACH,EAAIM,GAAG,wCAAwCL,EAAG,IAAI,CAACI,MAAM,CAACL,EAAIrG,eAAiB,mBAAqB,IAAIyG,MAAM,CAAC,KAAO,gBAAgBI,GAAG,CAAC,MAAQR,EAAItB,YAAY,CAACsB,EAAIM,GAAG,cAAcN,EAAIyB,GAAGzB,EAAIrG,gBAAkB,aAAaqG,EAAIM,GAAG,KAAKL,EAAG,eAAe,EACvvG,GACqB,CAAC,WAAY,IAAID,EAAI,KAAKC,EAAGD,EAAIE,MAAMD,GAAG,OAAOA,EAAG,IAAI,CAACE,YAAY,kCAAkC,CAACH,EAAIM,GAAG,6BAA6BL,EAAG,IAAI,CAACD,EAAIM,GAAG,WAAWN,EAAIM,GAAG,sBAClM,IEQC,EACA,KACA,KACA,MAIa,UAAAP,UAAiB,QAGhC2B,kBAAkB3B,UAAW,CAAC4B,WAAY,EAAQ,KAA+EC,S","file":"db317e2.js","sourcesContent":["\n// import VuePhoneNumberInput from 'vue-phone-number-input'\nimport 'vue-phone-number-input/dist/vue-phone-number-input.css'\nimport { mapMutations, mapState } from 'vuex'\n\nexport default {\n  name: 'UserAuth',\n  components: {\n    VuePhoneNumberInput: () => import('vue-phone-number-input')\n  },\n  layout: 'auth',\n  data () {\n    return {\n      focus: null,\n      country: null,\n      enteredPhone: null,\n      recaptcha: null,\n      resend_counter: null,\n      result: null,\n      enterOTP: false,\n      verifier: null,\n      otp: {},\n      otpDigits: ['a', 'b', 'c', 'd', 'e', 'f'],\n      username: null\n    }\n  },\n  head () {\n    return {\n      title: '📞 Jambo Talk - Login'\n    }\n  },\n  computed: mapState(['darkTheme']),\n  watch: {\n    otp: {\n      handler ({ a, b, c, d, e, f }) {\n        const arr = [a, b, c, d, e, f]\n        if (arr.findIndex(v => v && `${v}`.length !== 1) === -1) {\n          return\n        }\n        for (let i = 0; i < arr.length; i++) {\n          const val = `${arr[i]}`\n          if (val.length > 1 && val.length !== 6) {\n            this.defaultOtp()\n            return setTimeout(() => {\n              this.$refs.OTPinputs[0].focus()\n            }, 100)\n          }\n          if (val.length === 6) {\n            this.$refs.OTPinputs.forEach((el) => {\n              el.blur()\n            })\n            const [a, b, c, d, e, f] = val.split('')\n            return setTimeout(() => {\n              this.otp = {\n                a, b, c, d, e, f\n              }\n            }, 50)\n          }\n        }\n      },\n      deep: true\n    }\n  },\n  mounted () {\n    const otp = document.querySelectorAll('.otp')\n    if (otp[0]) {\n      otp.forEach((el) => {\n        el.addEventListener('focus', (e) => { el.value = '' })\n        el.addEventListener('input', (e) => { el.nextElementSibling ? el.nextElementSibling.focus() : el.blur() })\n      })\n    }\n    this.defaultOtp()\n  },\n  methods: {\n    ...mapMutations(['saveCreds']),\n    async setupVerify () {\n      if (this.verifier) {\n        return Promise.resolve(this.verifier)\n      }\n      const { RecaptchaVerifier } = this.$fireModule.auth\n      this.verifier = new RecaptchaVerifier(this.$refs.recaptcha, { size: 'invisible' })\n      await this.verifier.verify()\n      this.recaptcha = this.verifier\n      return Promise.resolve(this.recaptcha)\n    },\n    register () {\n      const { isValid, formattedNumber } = this.enteredPhone || {}\n      if (!isValid) {\n        return this.$nuxt.$emit('alert', { msg: 'Invalid phone', role: 'warn', timeout: 3000 })\n      } else {\n        this.$nuxt.$emit('alert', { msg: 'Validating...', role: 'loading', loading: true })\n      }\n      return this.setupVerify()\n        .then((recaptcha) => {\n          return this.$fire.auth.signInWithPhoneNumber(formattedNumber, recaptcha)\n        })\n        .then((result) => {\n          this.result = result\n          this.defaultOtp()\n          this.$nuxt.$emit('alert', {})\n          this.enterOTP = true\n          this.username = formattedNumber\n        })\n        .catch((err) => {\n          const msg = (err && err.code) ? err.message : 'Error, please reload page'\n          console.log({ msg }, err)\n          return this.$nuxt.$emit('alert', { msg: 'Error, please reload page', role: 'error', timeout: 3000 })\n        })\n    },\n    resendCounter (duration = 115) {\n      let timer = duration\n      let minutes\n      let seconds\n      const tm = setInterval(() => {\n        minutes = parseInt(timer / 60, 10)\n        seconds = parseInt(timer % 60, 10)\n\n        minutes = minutes < 10 ? '0' + minutes : minutes\n        seconds = seconds < 10 ? '0' + seconds : seconds\n        this.resend_counter = `in ${minutes}:${seconds}`\n        if (--timer < 0) {\n          this.resend_counter = null\n          clearInterval(tm)\n        }\n      }, 1000)\n    },\n    defaultOtp () {\n      const otp = {}\n      this.otpDigits.forEach((o) => {\n        otp[o] = '●'\n      })\n      this.otp = otp\n    },\n    resendOtp () {\n      if (this.resend_counter) {\n        return\n      }\n      this.resendCounter()\n      this.$fire.auth.signInWithPhoneNumber(this.username, this.recaptcha)\n        .then((res) => {\n          this.result = res\n          this.defaultOtp()\n          this.enterOTP = true\n        })\n        .catch((err) => {\n          console.error(err)\n        })\n    },\n    verifyOTP () {\n      const code = Object.values(this.otp).join('')\n      if (!this.result) {\n        return this.$nuxt.$emit('alert', { msg: 'Error, reload page.', role: 'error' })\n      }\n      this.enterOTP = false\n      this.$nuxt.$emit('alert', { msg: 'Verifying...', role: 'loading', loading: true })\n      this.result\n        .confirm(code)\n        .then(async () => {\n          const token = await this.$fire.auth.currentUser.getIdToken()\n          const { phoneNumber: phone, uid } = this.$fire.auth.currentUser\n          this.$axios.setToken(token, 'Bearer')\n          try {\n            const creds = await this.$axios.$get(`v0.1/register/${uid}`)\n            this.saveCreds({ ...creds, username: phone })\n            this.$nuxt.$emit('alert', { msg: 'Registration successful', role: 'success', timeout: 3300 })\n          } catch (error) {\n            return this.$nuxt.$emit('alert', { msg: 'Error. Refresh page', role: 'error' })\n          }\n          return setTimeout(() => {\n            return this.$router.push('/')\n          }, 1000)\n        })\n        .catch(() => {\n          this.enterOTP = true\n        })\n    }\n  }\n}\n","import mod from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./auth.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./auth.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./auth.vue?vue&type=template&id=1d00586e&\"\nimport script from \"./auth.vue?vue&type=script&lang=js&\"\nexport * from \"./auth.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* nuxt-component-imports */\ninstallComponents(component, {UtilsAlert: require('/home/joemags/Code/BOTS/XASH1/VOIP/app-jambotalk/components/Utils/Alert.vue').default})\n"],"sourceRoot":""}