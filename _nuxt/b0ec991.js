(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{375:function(e,t,r){"use strict";r.r(t);r(40),r(30),r(39),r(55),r(56);var n=r(2),o=r(26),c=(r(17),r(10),r(34),r(35),r(69),r(133),r(334),r(335)),l=r.n(c),f=(r(336),r(33));function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var d={name:"UserAuth",components:{VuePhoneNumberInput:l.a},layout:"auth",data:function(){return{country:null,enteredPhone:null,recaptcha:null,resend_counter:null,result:null,enterOTP:!1,verifier:null,otp:{},otpDigits:["a","b","c","d","e","f"]}},computed:Object(f.c)(["darkTheme"]),mounted:function(){var e,t=document.querySelectorAll(".otp");t[0]&&t.forEach((function(e){e.addEventListener("focus",(function(t){e.value=""})),e.addEventListener("input",(function(t){e.nextElementSibling?e.nextElementSibling.focus():e.blur()}))})),this.defaultOtp(),console.log(null===(e=this.$fire.auth)||void 0===e?void 0:e.currentUser)},methods:v(v({},Object(f.b)(["saveCreds"])),{},{setupVerify:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.verifier){t.next=2;break}return t.abrupt("return",Promise.resolve(e.verifier));case 2:return r=e.$fireModule.auth.RecaptchaVerifier,e.verifier=new r(e.$refs.recaptcha,{size:"invisible"}),t.next=6,e.verifier.verify();case 6:return e.recaptcha=e.verifier,t.abrupt("return",Promise.resolve(e.recaptcha));case 8:case"end":return t.stop()}}),t)})))()},register:function(){var e=this,t=this.enteredPhone||{},r=t.isValid,n=t.formattedNumber;return r?(this.$nuxt.$emit("alert",{msg:"Validating...",role:"loading",loading:!0}),this.setupVerify().then((function(t){return e.$fire.auth.signInWithPhoneNumber(n,t)})).then((function(t){e.result=t,e.defaultOtp(),e.$nuxt.$emit("alert",{}),e.enterOTP=!0})).catch((function(t){var r=t&&t.code?t.message:"Error, please reload page";return console.log({msg:r},t),e.$nuxt.$emit("alert",{msg:r,role:"error",timeout:3e3})}))):this.$nuxt.$emit("alert",{msg:"Invalid phone",role:"warn",timeout:3e3})},resendCounter:function(){var e,t,r=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:115,o=n,c=setInterval((function(){e=parseInt(o/60,10),t=parseInt(o%60,10),e=e<10?"0"+e:e,t=t<10?"0"+t:t,r.resend_counter="in ".concat(e,":").concat(t),--o<0&&(r.resend_counter=null,clearInterval(c))}),1e3)},defaultOtp:function(){var e={};this.otpDigits.forEach((function(t){e[t]="●"})),this.otp=e},resendOtp:function(){var e=this;this.resend_counter||(this.resendCounter(),this.$fire.auth.signInWithPhoneNumber(this.formatted_phone,this.recaptcha).then((function(t){e.result=t,console.log("Configured Verifier",t),e.defaultOtp(),e.enterOTP=!0})).catch((function(e){console.error(e)})))},userClaims:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getIdToken(!0);case 2:return r=t.sent,t.prev=3,t.next=6,e.getIdTokenResult();case 6:return n=t.sent,(o=n.claims)&&(o.token=r),t.abrupt("return",Promise.resolve(o||{}));case 12:return t.prev=12,t.t0=t.catch(3),t.abrupt("return",Promise.resolve({}));case 15:case"end":return t.stop()}}),t,null,[[3,12]])})))()},verifyOTP:function(){var e=this,code=Object.values(this.otp).join("");if(!this.result)return this.$nuxt.$emit("alert",{msg:"Error, reload page.",role:"error"});this.enterOTP=!1,this.$nuxt.$emit("alert",{msg:"Verifying...",role:"loading",loading:!0}),this.result.confirm(code).then(Object(n.a)(regeneratorRuntime.mark((function t(){var r,o,c,l,f,m,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$fire.auth.currentUser,t.next=3,e.userClaims(r);case 3:if(o=t.sent,l=(c=r||{}).phoneNumber,f=c.uid,!l){t.next=8;break}return t.next=8,e.$fire.database.ref("/users/".concat(f)).set({reg:!0});case 8:m=0,v=setInterval(Object(n.a)(regeneratorRuntime.mark((function t(){var n,c,f,d,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.userClaims(r);case 2:if(n=t.sent,console.log(n),n.pwd===o.pwd){t.next=9;break}return c=n.pwd,f=n.host,d=n.account,h=n.token,e.saveCreds({username:l,pwd:c,host:f,account:d,token:h}),clearInterval(v),t.abrupt("return",e.$router.push("/"));case 9:++m>=10&&clearInterval(v);case 11:case"end":return t.stop()}}),t)}))),1e3),e.$nuxt.$emit("alert",{msg:"Registration successful",role:"success",timeout:3300});case 11:case"end":return t.stop()}}),t)})))).catch((function(t){var r=t.message;t.stack&&(r=t.stack),console.log(r),e.enterOTP=!0}))}})},h=d,O=r(14),component=Object(O.a)(h,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"page-content pb-0"},[t("div",{staticClass:"card tw-h-screen",attrs:{"data-card-height":"cover"}},[t("div",{staticClass:"card-center",staticStyle:{"margin-top":"-200px"}},[t("div",{staticClass:"ps-5 pe-5"},[t("h3",{staticClass:"text-center mb-4"},[e._v("\n            Enter your phone number\n          ")]),e._v(" "),t("VuePhoneNumberInput",{staticClass:"tw-mb-3",attrs:{"default-country-code":"ZW","no-example":!0,dark:e.darkTheme,size:"lg"},on:{update:function(t){e.enteredPhone=t}},model:{value:e.country,callback:function(t){e.country=t},expression:"country"}}),e._v(" "),t("p",{staticClass:"text-center font-12 mt-n2 mb-2"},[e._v("\n            Carrier charges may apply\n          ")]),e._v(" "),t("a",{staticClass:"btn btn-full btn-m shadow-large rounded-sm text-uppercase font-700 bg-highlight",on:{click:e.register}},[e._v("\n            Register\n          ")])],1)])]),e._v(" "),t("div",{ref:"recaptcha",staticClass:"absolute"})]),e._v(" "),t("div",{staticClass:"menu menu-box-bottom tw-block tw-h-full tw-w-full",class:{"menu-active":e.enterOTP},attrs:{id:"menu-user","data-menu-width":"cover","data-menu-effect":"menu-over"}},[t("div",[t("a",{staticClass:"close-menu icon icon-m mt-n2 notch-clear position-absolute start-0 color-theme",on:{click:function(t){e.enterOTP=!e.enterOTP}}},[t("i",{staticClass:"fa fa-chevron-left"})]),e._v(" "),t("img",{staticClass:"mx-auto",attrs:{src:"/assets/images/2.svg",width:"200"}}),e._v(" "),t("h1",{staticClass:"text-center pt-4"},[e._v("\n        Enter One Time Passcode\n      ")]),e._v(" "),e._m(0),e._v(" "),t("div",{staticClass:"text-center mb-3 pt-3 pb-2"},[t("form",{attrs:{action:""}},e._l(e.otpDigits,(function(r){return t("input",{directives:[{name:"model",rawName:"v-model",value:e.otp[r],expression:"otp[o]"}],key:r,staticClass:"otp mx-1 text-center font-24 font-900",attrs:{type:"tel"},domProps:{value:e.otp[r]},on:{input:function(t){t.target.composing||e.$set(e.otp,r,t.target.value)}}})})),0)]),e._v(" "),t("a",{staticClass:"btn btn-highlight rounded-sm btn-m tw-bg-primary-500 active:tw-bg-primary-700 text-uppercase font-700 mt-4 btn-center-xl",on:{click:e.verifyOTP}},[e._v("\n        Verify\n      ")]),e._v(" "),t("p",{staticClass:"pt-2 font-11 text-center mb-0"},[e._v("\n        Didn't receive your code? "),t("a",{class:[e.resend_counter?"tw-text-gray-400":""],attrs:{href:"javascript:;"},on:{click:e.resendOtp}},[e._v("Resend OTP "+e._s(e.resend_counter||""))])])])]),e._v(" "),t("UtilsAlert")],1)}),[function(){var e=this,t=e._self._c;return t("p",{staticClass:"text-center font-12 mt-n2 mb-2"},[e._v("\n        To verify your "),t("b",[e._v("Jambo")]),e._v(" account.\n      ")])}],!1,null,null,null);t.default=component.exports;installComponents(component,{UtilsAlert:r(202).default})}}]);